# 38_브라우저의 렌더링 과정

렌더링이란?
> HTML, CSS, 자바스크립트로 작성된 문서를 파싱하여 브라우저에서 시각적으로 출력하는 것

<br>
<br>
<br>

## 브라우저의 렌더링 과정

1. 요청과 응답

    - HTML,CSS,자바스크립트, 이미지, 폰트 파일 등 렌더링에 필요한 리소스를 요청하고 서버로부터 응답을 받는다.

<br>

2. HTML 파싱과 DOM 생성
    - 응답받은 HTML 문서를 파싱하여 브라우저가 이해할 수 있는 자료구조인 `DOM`을 생성한다.

    <br>

    ![dsg](https://user-images.githubusercontent.com/82991292/139198332-5a23c473-8ff1-4fc0-9a89-e1fc878ffcf9.JPG)


<br>

3. CSS 파싱과 CSSOM 생성
    - 렌더링 엔진은 DOM을 생성해 나가다가 CSS를 로드하는 link태그나 style 태그를 만나면 DOM 생성을 일시 중단한다.
    - link 태그의 href 어트리뷰트에 지정된 CSS 파일을 서버에 요청하여 로드한 CSS 파일이나 style 태그 내의 CSS를 HTML과 동일한 파싱과정을 거치며 `CSSOM`을 생성한다.
     
<br>

4. 렌더 트리 생성
    - 브라우저의 렌더링 엔진은 서버로부터 응답된 HTML과 CSS를 파싱하여 DOM과 CSSOM을 생성하고 이들을 결합하여 `렌더 트리`를 생성한다.
    - 이 때 브라우저 화면에 렌더링되지 않는 노드(meta 태그, script 태그)와 CSS에 의해 비표시(display : none)되는 노드들은 포함되지 않는다.

    <br>

    ![nknn](https://user-images.githubusercontent.com/82991292/139198575-945fc5f2-6d51-40a9-b3d3-185fb383d323.JPG)

    ![캡처lllk](https://user-images.githubusercontent.com/82991292/139198624-88e4ca3b-7431-4502-bbd5-282947f8f6f1.JPG)
    
<br>

5. 자바스크립트 파싱과 실행
    - 렌더링 엔진은 HTML을 한 줄씩 순차적으로 파싱하며 DOM을 생성해 나가다가 script 태그를 만나면 DOM 생성을 일시 중단한다.
    - 이 때 제어권이 렌더링 엔진에서 자바스크립트 엔진으로 넘어간다.
    - 브라우저의 자바스크립트 엔진은 서버로부터 응답된 자바스크립트를 파싱하여 AST(프로그래밍 언어로 작성된 소스 코드의 추상 구문 구조의 트리)를 생성하고 바이트코드로 변환하여 실행한다.

    <br>

    ![kkj](https://user-images.githubusercontent.com/82991292/139203603-565bf258-9bcc-45b6-9e5e-bd3f9c45f9b5.JPG)

    - 이후 제어권이 다시 렌더링 엔진으로 넘어가고 렌더 트리를 기반으로 HTML 요소의 레이아웃을 계산하고 브라우저 화면에 HTML 요소를 페인팅 한다.

<br>

6. 리플로우와 리페인트
    - 만약 자바스크립트 코드에 DOM이나 CSSOM을 변경할 수 있는 DOM API가 사용된 경우라면 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합된다.
    - 변경된 렌더 트리를 기반으로 레이아웃과 페인트 과정을 거쳐 브라우저의 화면에 다시 렌더링한다.

    <br>
     
    ＋ 리플로우 : 레이아웃 계산을 다시 하는 것  
    ＋ 리페인팅 : 재결합된 렌더 트리를 기반으로 다시 페인트를 하는 것

    <br>

    ![hihihi](https://user-images.githubusercontent.com/82991292/139203652-0c3e4d8a-6381-46e8-8d48-ccafc41daef2.JPG)

    
<br>
<br>
<br>

## 자바스크립트 파싱에 의한 HTML 파싱 중단

<br>

자바스크립트 코드에서 DOM이나 CSSOM을 변경하는 DOM API를 사용할 경우 DOM의 생성이 완료되지 않은 상태라면 코드가 정상적으로 동작하지 않는 문제가 발생한다. 이를 다음의 세 가지 방법으로 해결할 수 있다.

1. body 요소의 가장 아래에 자바스크립트를 위치시킨다.

2. async 어트리뷰트
    - HTML파싱과 외부 자바스크립트 파일의 로드가 동기적으로 동시에 진행된다.
    - 자바스크립트 파싱과 실행은 자바스크립트 파일의 로드가 완료된 직후 진행된다.
    - 여러 개의 script 태그에 지정할 경우 순서가 보장되지 않는다.
    
3. defer 어트리뷰트
    - HTML파싱과 외부 자바스크립트 파일의 로드가 동기적으로 동시에 진행된다.
    - 자바스크립트 파싱과 실행은 DOM 생성이 완료된 직후에 진행된다.